{"version":3,"sources":["../../../../widgets/CartoMaintenanceWgt/case/Independence.js"],"names":["define","Deferred","QueryTask","Query","esriRequest","StatisticDefinition","UtilityCase","Independence","codRequest","user","ubigeo","cadastralBlockUrl","matrixLand","newLands","urlLands","lands","config","matrixLandDomain","caseRequest","currentLotsRows","getMatrixLand","deferred","LandCls","Land","queryTask","query","returnGeometry","outFields","tipPred","where","codPre","cpm","execute","then","result","features","attributes","resolve","catch","reject","err","promise","getUiOfLot","LotCls","Lot","statDefCodUi","statisticType","onStatisticField","codUi","outStatisticFieldName","outStatistics","idLotP","uiValue","updateMatrixLand","updateTipPredLand","setParametersToUpdateFeatures","landUrl","usePost","calculateLandFields","getFeatureSchema","forEach","landProps","landSchema","clone","attributeTransfer","objTarget","objBase","land","pointLot","omitPropsDefault","estado","estadoValue","coordX","geometry","x","coordY","y","fuente","nomPc","platformUpdate","nomUser","codVer","getValueCodVer","ranCpu","codCpu","generateCodCpu","dirMun","generateDirMun","tipVia","nomVia","numMun","dirUrb","generateDirUrb","push","executeIndependence","calculateIdMznC","calculateIdPred","addDataNew","updateStatusRequests"],"mappings":"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","file":"Independence.js","sourcesContent":["define([\r\n    \"dojo/Deferred\",\r\n    \"esri/tasks/QueryTask\",\r\n    \"esri/tasks/query\",\r\n    \"esri/request\",\r\n    \"esri/tasks/StatisticDefinition\",\r\n    \"./UtilityCase\",\r\n], function (\r\n    Deferred,\r\n    QueryTask,\r\n    Query,\r\n    esriRequest,\r\n    StatisticDefinition,\r\n    UtilityCase,\r\n) {\r\n    /*\r\n    * @description: Objeto que contiene las funciones para la subdivisiÃ³n de lotes\r\n    */\r\n    const Independence = {\r\n        codRequest: null, // @params: CÃ³digo de la solicitud\r\n        user: null, // @params\r\n        ubigeo: null, // @params\r\n        cadastralBlockUrl: null, // @params\r\n        matrixLand: null, // @params\r\n        newLands: null, // @param: nuevos predios\r\n        urlLands: null, // @param\r\n        lands: null, // @calculate\r\n        config: null, // @calculate\r\n        matrixLandDomain: '2',\r\n        caseRequest: null, // @param\r\n        currentLotsRows: null, //@param\r\n\r\n\r\n        getMatrixLand() {\r\n            const deferred = new Deferred();\r\n            const LandCls = new UtilityCase.Land();\r\n            const queryTask = new QueryTask(this.urlLands);\r\n            const query = new Query();\r\n            query.returnGeometry = false;\r\n            query.outFields = [\"OBJECTID\", \"GLOBALID\", LandCls.tipPred];\r\n            query.where = `${LandCls.codPre} = '${this.matrixLand[0].cpm}' and ${LandCls.ubigeo} = '${this.ubigeo}'`;\r\n            queryTask.execute(query)\r\n                .then(result => {\r\n                    const matrixLand = result.features;\r\n                    matrixLand[0].attributes[LandCls.tipPred] = this.matrixLandDomain;\r\n                    return deferred.resolve(matrixLand);\r\n                })\r\n                .catch(err => deferred.reject(err));\r\n            return deferred.promise;\r\n        },\r\n\r\n        getUiOfLot() {\r\n            const LotCls = new UtilityCase.Lot();\r\n            const deferred = new Deferred();\r\n            const LandCls = new UtilityCase.Land();\r\n            const queryTask = new QueryTask(this.urlLands);\r\n            const query = new Query();\r\n\r\n            const statDefCodUi = new StatisticDefinition();\r\n            statDefCodUi.statisticType = \"max\";\r\n            statDefCodUi.onStatisticField = LandCls.codUi;\r\n            statDefCodUi.outStatisticFieldName = `${LandCls.codUi}_MAX`;\r\n            query.outStatistics = [statDefCodUi];\r\n\r\n            query.where = `${LotCls.idLotP} = '${this.currentLotsRows[0].attributes[LotCls.idLotP]}' and ${LotCls.ubigeo} = '${this.ubigeo}'`\r\n\r\n            queryTask.execute(query)\r\n                .then(result => {\r\n                    const uiValue = result.features[0].attributes[`${LandCls.codUi}_MAX`] + 1;\r\n                    return deferred.resolve(uiValue);\r\n                })\r\n                .catch(err => deferred.reject(err));\r\n            return deferred.promise;\r\n        },\r\n\r\n        updateMatrixLand(matrixLand) {\r\n            // this.lands = JSON.stringify(matrixLand);\r\n            const deferred = new Deferred();\r\n            const updateTipPredLand = UtilityCase.setParametersToUpdateFeatures(\r\n                this.config.landUrl,\r\n                matrixLand\r\n            );\r\n\r\n\r\n\r\n            esriRequest(updateTipPredLand, { usePost: true })\r\n                .then(result => {\r\n                    return deferred.resolve(result);\r\n                })\r\n                .catch(err => deferred.reject(err));\r\n\r\n            return deferred.promise;\r\n        },\r\n\r\n        calculateLandFields(uiValue) {\r\n            const deferred = new Deferred();\r\n            const LandCls = new UtilityCase.Land();\r\n            const LotCls = new UtilityCase.Lot();\r\n            const lands = [];\r\n            // let uiValue = UtilityCase.codUiValue\r\n\r\n            UtilityCase.getFeatureSchema(this.urlLands)\r\n                .then(landSchema => {\r\n                    this.newLands.forEach(land => {\r\n                        const landProps = landSchema.clone();\r\n                        landProps.attributes = UtilityCase.attributeTransfer({\r\n                            objTarget: landSchema.attributes,\r\n                            objBase: land.pointLot.attributes,\r\n                            omitPropsDefault: false\r\n                        });\r\n                        landProps.attributes[LandCls.codPre] = land.cpm;\r\n                        landProps.attributes[LandCls.codUi] = uiValue;\r\n                        landProps.attributes[LandCls.estado] = UtilityCase.estadoValue;\r\n                        landProps.attributes[LandCls.coordX] = land.pointLot.geometry.x;\r\n                        landProps.attributes[LandCls.coordY] = land.pointLot.geometry.y;\r\n                        landProps.attributes[LotCls.fuente] = this.codRequest;\r\n                        landProps.attributes[LotCls.nomPc] = UtilityCase.platformUpdate;\r\n                        landProps.attributes[LotCls.nomUser] = this.user;\r\n                        landProps.attributes[LandCls.tipPred] = land.tipPred;\r\n                        landProps.attributes[LandCls.codVer] = UtilityCase.getValueCodVer(\r\n                            landProps.attributes[LandCls.ranCpu],\r\n                            uiValue\r\n                        );\r\n                        landProps.attributes[LandCls.codCpu] = UtilityCase.generateCodCpu(\r\n                            landProps.attributes[LandCls.ranCpu],\r\n                            landProps.attributes[LandCls.codVer],\r\n                            codUi = uiValue\r\n                        );\r\n\r\n                        landProps.attributes[LandCls.dirMun] = UtilityCase.generateDirMun(\r\n                            landProps.attributes[LandCls.tipVia],\r\n                            landProps.attributes[LandCls.nomVia],\r\n                            landProps.attributes[LandCls.numMun]\r\n                        );\r\n                        landProps.attributes[LandCls.dirUrb] = UtilityCase.generateDirUrb(\r\n                            landProps.attributes[LandCls.tipVia],\r\n                            landProps.attributes[LandCls.nomVia],\r\n                            landProps.attributes[LandCls.numMun]\r\n                        );\r\n                        landProps.geometry = land.pointLot.geometry;\r\n                        uiValue = uiValue + 1;\r\n                        lands.push(landProps.clone());\r\n                    });\r\n                    return deferred.resolve(lands);\r\n                })\r\n                .catch(err => deferred.reject(err));\r\n            return deferred.promise;\r\n        },\r\n\r\n        executeIndependence() {\r\n            return this.getUiOfLot()\r\n                .then(uiValue => this.calculateLandFields(uiValue))\r\n                .then(lands => UtilityCase.calculateIdMznC(lands, this.cadastralBlockUrl, this.ubigeo))\r\n                .then(lands => UtilityCase.calculateIdPred(lands, this.urlLands, this.ubigeo))\r\n                .then(lands => {\r\n                    this.lands = lands;\r\n                    return UtilityCase.addDataNew([], [], lands, this.config)\r\n                })\r\n                .then(lands => this.getMatrixLand())\r\n                .then(matrixLand => this.updateMatrixLand(matrixLand))\r\n                .then(results => UtilityCase.updateStatusRequests(this.lands, this.codRequest, this.caseRequest, this.ubigeo, this.config))\r\n                .then(result => result)\r\n                .catch(err => err);\r\n        },\r\n    };\r\n    return Independence;\r\n});"]}